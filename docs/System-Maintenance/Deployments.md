# Deployments

As it stands the CI/CD pipeline is using GitHub Actions under the hood. Builds themselves are also done during those actions, so you can find all the details in the platform repo under the corresponding instance branch `deploy/<instance name>`. The script at the end of those deployments should just copy the resulting builds and properly move the files into their respective folders, while removing unecessary / backuping necessary files & restarting docker containers.

!!! warning "Sometimes docker restarts mess with IP and the routing breaks, TODO fix this"


## Front-end

There's a simple webpack configuration for building production-ready front-end. There are a few quirks or missing parts though:

1. As it stands I can't dynamically load page title (used to differentiate between instances) from configuration inside webpack config, the auto-generated `index.html` will always come with default title that you'll need to adjust manually (only once, the index.html won't get overriden for most deployments).
2. It's aleady been added to the deployment actions & scripts, but still pay close attention to how `public` folder is created and be sure to move over all your custom config files in there (they won't be touched by automatic deployment tools) if you want public functionality to work within our platform.
3. As stated previously config values can't be realistically pre-filled for deployments so you'll have to fill those yourself (currently there are two configs: one generic and one for firebase). The placeholders should be copied over with `PLACEHOLDER_` prefix in the filename, it should give you an idea on what fields are required.

!!! danger "Correct asset loading is WIP, the routing appears to be somewhat broken or inconsistent, for fonts and other assets especially"


## Back-end

There's a bundler plugin for sbt that produces full builds of our backend without much issues. Some notes:

1. As with the front-end you'll have to manually supply correct configuration files, unfortunately there are no placeholder files generated by the build process for now so you'll have to copy and adapt previous instances config files / check platform repo for those. Most important are `flow2b.conf` and `application.conf`. You'll probably also need to copy orientdb configuration files assuming you're moving existing DB over there and not starting from clean slate.
2. Back-end requires a lot of ENV variables and JAVA args to be present in order to function at all (also lots of optimizations are done there). No templates for that yet as well, you can look into `build.sbt` of the platform to check which env variables are defined there but your best bet would be to copy over the run script and args files from existing instances.
